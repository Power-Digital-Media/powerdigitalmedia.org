{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///E:/AntiGravity/First%20Project/Power%20Digital%20Media/power-digital-media-web/src/lib/amazon/paapi.ts"],"sourcesContent":["import { NextResponse } from 'next/server';\r\n\r\ninterface CreatorsConfig {\r\n    clientId: string;\r\n    clientSecret: string;\r\n    partnerTag: string;\r\n}\r\n\r\n// In-memory token cache\r\nlet tokenCache: { token: string; expiresAt: number } | null = null;\r\n\r\nasync function getAccessToken(clientId: string, clientSecret: string): Promise<string> {\r\n    // Check cache first\r\n    if (tokenCache && Date.now() < tokenCache.expiresAt) {\r\n        return tokenCache.token;\r\n    }\r\n\r\n    const tokenUrl = 'https://api.amazon.com/auth/o2/token';\r\n    const params = new URLSearchParams({\r\n        grant_type: 'client_credentials',\r\n        client_id: clientId,\r\n        client_secret: clientSecret,\r\n        scope: 'advertising::campaign_management' // Standard scope for Creators/Advertising\r\n    });\r\n\r\n    try {\r\n        const response = await fetch(tokenUrl, {\r\n            method: 'POST',\r\n            headers: {\r\n                'Content-Type': 'application/x-www-form-urlencoded;charset=UTF-8'\r\n            },\r\n            body: params\r\n        });\r\n\r\n        if (!response.ok) {\r\n            const errorText = await response.text();\r\n            console.error('Creators API Token Error:', errorText);\r\n            throw new Error(`Token exchange failed: ${response.status}`);\r\n        }\r\n\r\n        const data = await response.json();\r\n        const expiresIn = data.expires_in || 3600;\r\n\r\n        // Cache token (subtract 60s for safety)\r\n        tokenCache = {\r\n            token: data.access_token,\r\n            expiresAt: Date.now() + (expiresIn * 1000) - 60000\r\n        };\r\n\r\n        return data.access_token;\r\n    } catch (error) {\r\n        console.error('Auth Error:', error);\r\n        throw error;\r\n    }\r\n}\r\n\r\nexport async function fetchAmazonProduct(asin: string) {\r\n    const config: CreatorsConfig = {\r\n        clientId: '333hmld7a435j7h666an5hcvao', // User Provided\r\n        clientSecret: '1l22915mokvel7fk5hj8v6s6fnbl5d4roj8vrjckk7b6gt1dpap9', // User Provided\r\n        partnerTag: 'powerdigital1-20'\r\n    };\r\n\r\n    try {\r\n        // 1. Get OAuth Token\r\n        const accessToken = await getAccessToken(config.clientId, config.clientSecret);\r\n\r\n        // 2. Fetch Product Data\r\n        // Note: Using the v2/GetItems endpoint for Creators\r\n        const endpoint = 'https://api.amazon.com/product-advertising-api/v1/getitems';\r\n\r\n        const payload = {\r\n            ItemIds: [asin],\r\n            Resources: [\r\n                'Offers.Listings.Price',\r\n                'Images.Primary.Large',\r\n                'ItemInfo.Title',\r\n                'ItemInfo.ProductInfo',\r\n                'ItemInfo.ExternalIds'\r\n            ],\r\n            PartnerTag: config.partnerTag,\r\n            PartnerType: 'Associates',\r\n            Marketplace: 'www.amazon.com'\r\n        };\r\n\r\n        const response = await fetch(endpoint, {\r\n            method: 'POST',\r\n            headers: {\r\n                'Authorization': `Bearer ${accessToken}`,\r\n                'Content-Type': 'application/json',\r\n                'Accept': 'application/json',\r\n                'Host': 'api.amazon.com'\r\n            },\r\n            body: JSON.stringify(payload)\r\n        });\r\n\r\n        if (!response.ok) {\r\n            console.warn(`Creators API Fetch Failed [${response.status}]:`, await response.text());\r\n            return null;\r\n        }\r\n\r\n        const data = await response.json();\r\n\r\n        if (data.ItemsResult?.Items?.length > 0) {\r\n            const item = data.ItemsResult.Items[0];\r\n            return {\r\n                asin: item.ASIN,\r\n                title: item.ItemInfo?.Title?.DisplayValue,\r\n                price: item.Offers?.Listings?.[0]?.Price?.DisplayAmount || 'N/A',\r\n                image: item.Images?.Primary?.Large?.URL,\r\n                liveLink: item.DetailPageURL\r\n            };\r\n        }\r\n\r\n        return null;\r\n\r\n    } catch (error) {\r\n        console.error('Creators API Error:', error);\r\n        return null;\r\n    }\r\n}\r\n"],"names":[],"mappings":";;;;AAQA,wBAAwB;AACxB,IAAI,aAA0D;AAE9D,eAAe,eAAe,QAAgB,EAAE,YAAoB;IAChE,oBAAoB;IACpB,IAAI,cAAc,KAAK,GAAG,KAAK,WAAW,SAAS,EAAE;QACjD,OAAO,WAAW,KAAK;IAC3B;IAEA,MAAM,WAAW;IACjB,MAAM,SAAS,IAAI,gBAAgB;QAC/B,YAAY;QACZ,WAAW;QACX,eAAe;QACf,OAAO,mCAAmC,0CAA0C;IACxF;IAEA,IAAI;QACA,MAAM,WAAW,MAAM,MAAM,UAAU;YACnC,QAAQ;YACR,SAAS;gBACL,gBAAgB;YACpB;YACA,MAAM;QACV;QAEA,IAAI,CAAC,SAAS,EAAE,EAAE;YACd,MAAM,YAAY,MAAM,SAAS,IAAI;YACrC,QAAQ,KAAK,CAAC,6BAA6B;YAC3C,MAAM,IAAI,MAAM,CAAC,uBAAuB,EAAE,SAAS,MAAM,EAAE;QAC/D;QAEA,MAAM,OAAO,MAAM,SAAS,IAAI;QAChC,MAAM,YAAY,KAAK,UAAU,IAAI;QAErC,wCAAwC;QACxC,aAAa;YACT,OAAO,KAAK,YAAY;YACxB,WAAW,KAAK,GAAG,KAAM,YAAY,OAAQ;QACjD;QAEA,OAAO,KAAK,YAAY;IAC5B,EAAE,OAAO,OAAO;QACZ,QAAQ,KAAK,CAAC,eAAe;QAC7B,MAAM;IACV;AACJ;AAEO,eAAe,mBAAmB,IAAY;IACjD,MAAM,SAAyB;QAC3B,UAAU;QACV,cAAc;QACd,YAAY;IAChB;IAEA,IAAI;QACA,qBAAqB;QACrB,MAAM,cAAc,MAAM,eAAe,OAAO,QAAQ,EAAE,OAAO,YAAY;QAE7E,wBAAwB;QACxB,oDAAoD;QACpD,MAAM,WAAW;QAEjB,MAAM,UAAU;YACZ,SAAS;gBAAC;aAAK;YACf,WAAW;gBACP;gBACA;gBACA;gBACA;gBACA;aACH;YACD,YAAY,OAAO,UAAU;YAC7B,aAAa;YACb,aAAa;QACjB;QAEA,MAAM,WAAW,MAAM,MAAM,UAAU;YACnC,QAAQ;YACR,SAAS;gBACL,iBAAiB,CAAC,OAAO,EAAE,aAAa;gBACxC,gBAAgB;gBAChB,UAAU;gBACV,QAAQ;YACZ;YACA,MAAM,KAAK,SAAS,CAAC;QACzB;QAEA,IAAI,CAAC,SAAS,EAAE,EAAE;YACd,QAAQ,IAAI,CAAC,CAAC,2BAA2B,EAAE,SAAS,MAAM,CAAC,EAAE,CAAC,EAAE,MAAM,SAAS,IAAI;YACnF,OAAO;QACX;QAEA,MAAM,OAAO,MAAM,SAAS,IAAI;QAEhC,IAAI,KAAK,WAAW,EAAE,OAAO,SAAS,GAAG;YACrC,MAAM,OAAO,KAAK,WAAW,CAAC,KAAK,CAAC,EAAE;YACtC,OAAO;gBACH,MAAM,KAAK,IAAI;gBACf,OAAO,KAAK,QAAQ,EAAE,OAAO;gBAC7B,OAAO,KAAK,MAAM,EAAE,UAAU,CAAC,EAAE,EAAE,OAAO,iBAAiB;gBAC3D,OAAO,KAAK,MAAM,EAAE,SAAS,OAAO;gBACpC,UAAU,KAAK,aAAa;YAChC;QACJ;QAEA,OAAO;IAEX,EAAE,OAAO,OAAO;QACZ,QAAQ,KAAK,CAAC,uBAAuB;QACrC,OAAO;IACX;AACJ"}},
    {"offset": {"line": 152, "column": 0}, "map": {"version":3,"sources":["file:///E:/AntiGravity/First%20Project/Power%20Digital%20Media/power-digital-media-web/src/app/api/amazon/product/route.ts"],"sourcesContent":["import { NextResponse } from 'next/server';\r\nimport { fetchAmazonProduct } from '@/lib/amazon/paapi';\r\n\r\nexport async function GET(request: Request) {\r\n    const { searchParams } = new URL(request.url);\r\n    const asin = searchParams.get('asin');\r\n\r\n    if (!asin) {\r\n        return NextResponse.json({ error: 'ASIN is required' }, { status: 400 });\r\n    }\r\n\r\n    try {\r\n        const product = await fetchAmazonProduct(asin);\r\n\r\n        if (!product || !product.ItemsResult) {\r\n            return NextResponse.json({ error: 'Product not found' }, { status: 404 });\r\n        }\r\n\r\n        return NextResponse.json(product);\r\n    } catch (error: any) {\r\n        console.error('API Route Error:', error);\r\n        return NextResponse.json({ error: error.message || 'Internal Server Error' }, { status: 500 });\r\n    }\r\n}\r\n"],"names":[],"mappings":";;;;AAAA;AACA;;;AAEO,eAAe,IAAI,OAAgB;IACtC,MAAM,EAAE,YAAY,EAAE,GAAG,IAAI,IAAI,QAAQ,GAAG;IAC5C,MAAM,OAAO,aAAa,GAAG,CAAC;IAE9B,IAAI,CAAC,MAAM;QACP,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,OAAO;QAAmB,GAAG;YAAE,QAAQ;QAAI;IAC1E;IAEA,IAAI;QACA,MAAM,UAAU,MAAM,IAAA,qJAAkB,EAAC;QAEzC,IAAI,CAAC,WAAW,CAAC,QAAQ,WAAW,EAAE;YAClC,OAAO,gJAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAAoB,GAAG;gBAAE,QAAQ;YAAI;QAC3E;QAEA,OAAO,gJAAY,CAAC,IAAI,CAAC;IAC7B,EAAE,OAAO,OAAY;QACjB,QAAQ,KAAK,CAAC,oBAAoB;QAClC,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,OAAO,MAAM,OAAO,IAAI;QAAwB,GAAG;YAAE,QAAQ;QAAI;IAChG;AACJ"}}]
}