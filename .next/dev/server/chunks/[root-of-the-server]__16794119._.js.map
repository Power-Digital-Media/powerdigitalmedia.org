{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 52, "column": 0}, "map": {"version":3,"sources":["file:///E:/AntiGravity/First%20Project/Power%20Digital%20Media/power-digital-media-web/src/lib/amazon/paapi.ts"],"sourcesContent":["import crypto from 'crypto';\r\n\r\ninterface PAAPIConfig {\r\n    accessKey: string;\r\n    secretKey: string;\r\n    associateTag: string;\r\n    region: string;\r\n    host: string;\r\n}\r\n\r\nexport async function fetchAmazonProduct(asin: string) {\r\n    const config: PAAPIConfig = {\r\n        accessKey: process.env.AMAZON_API_KEY || '',\r\n        secretKey: process.env.AMAZON_API_SECRET || '',\r\n        associateTag: process.env.NEXT_PUBLIC_AMAZON_AFFILIATE_ID || '',\r\n        region: 'us-east-1', // Default for US\r\n        host: 'webservices.amazon.com'\r\n    };\r\n\r\n    if (!config.accessKey || !config.secretKey) {\r\n        throw new Error('Amazon API credentials missing');\r\n    }\r\n\r\n    console.log(`PA-API Sync: Key[${config.accessKey.substring(0, 4)}...] Len[${config.accessKey.length}] Secret[${config.secretKey.substring(0, 4)}...] Len[${config.secretKey.length}]`);\r\n\r\n    const payload = JSON.stringify({\r\n        ItemIds: [asin],\r\n        ItemIdType: 'ASIN',\r\n        Resources: [\r\n            'Images.Primary.Large',\r\n            'ItemInfo.Title',\r\n            'Offers.Listings.Price'\r\n        ],\r\n        PartnerTag: config.associateTag,\r\n        PartnerType: 'Associates',\r\n        Marketplace: 'www.amazon.com'\r\n    });\r\n\r\n    const datetime = new Date().toISOString().replace(/[:\\-]|\\.\\d{3}/g, '');\r\n    const date = datetime.substr(0, 8);\r\n    const method = 'POST';\r\n    const uri = '/paapi5/get-items';\r\n    const target = 'com.amazon.paapi5.v1.ProductAdvertisingAPIv1.GetItems';\r\n    const contentType = 'application/json; charset=utf-8';\r\n\r\n    // 1. Canonical Request\r\n    const hashedPayload = crypto.createHash('sha256').update(payload).digest('hex');\r\n    const canonicalHeaders = `host:${config.host}\\nx-amz-date:${datetime}\\nx-amz-target:${target}\\n`;\r\n    const signedHeaders = 'host;x-amz-date;x-amz-target';\r\n    const canonicalRequest = `${method}\\n${uri}\\n\\n${canonicalHeaders}\\n${signedHeaders}\\n${hashedPayload}`;\r\n\r\n    // 2. String to Sign\r\n    const credentialScope = `${date}/${config.region}/ProductAdvertisingAPI/aws4_request`;\r\n    const hashedCanonicalRequest = crypto.createHash('sha256').update(canonicalRequest).digest('hex');\r\n    const stringToSign = `AWS4-HMAC-SHA256\\n${datetime}\\n${credentialScope}\\n${hashedCanonicalRequest}`;\r\n\r\n    // 3. Signing Key\r\n    const kDate = crypto.createHmac('sha256', `AWS4${config.secretKey}`).update(date).digest();\r\n    const kRegion = crypto.createHmac('sha256', kDate).update(config.region).digest();\r\n    const kService = crypto.createHmac('sha256', kRegion).update('ProductAdvertisingAPI').digest();\r\n    const kSigning = crypto.createHmac('sha256', kService).update('aws4_request').digest();\r\n\r\n    // 4. Signature\r\n    const signature = crypto.createHmac('sha256', kSigning).update(stringToSign).digest('hex');\r\n\r\n    const authorizationHeader = `AWS4-HMAC-SHA256 Credential=${config.accessKey}/${credentialScope}, SignedHeaders=${signedHeaders}, Signature=${signature}`;\r\n\r\n    const response = await fetch(`https://${config.host}${uri}`, {\r\n        method,\r\n        headers: {\r\n            'Content-Type': contentType,\r\n            'Content-Encoding': 'amz-1.0',\r\n            'X-Amz-Date': datetime,\r\n            'X-Amz-Target': target,\r\n            'Authorization': authorizationHeader,\r\n            'Host': config.host\r\n        },\r\n        body: payload\r\n    });\r\n\r\n    if (!response.ok) {\r\n        const errorText = await response.text();\r\n        console.error('Amazon API Error Response:', errorText);\r\n        throw new Error(`Amazon API returned ${response.status}`);\r\n    }\r\n\r\n    const json = await response.json();\r\n    console.log('Amazon API Success Response:', JSON.stringify(json, null, 2));\r\n    return json;\r\n}\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 132, "column": 0}, "map": {"version":3,"sources":["file:///E:/AntiGravity/First%20Project/Power%20Digital%20Media/power-digital-media-web/src/app/api/amazon/product/route.ts"],"sourcesContent":["import { NextResponse } from 'next/server';\r\nimport { fetchAmazonProduct } from '@/lib/amazon/paapi';\r\n\r\nexport async function GET(request: Request) {\r\n    const { searchParams } = new URL(request.url);\r\n    const asin = searchParams.get('asin');\r\n\r\n    if (!asin) {\r\n        return NextResponse.json({ error: 'ASIN is required' }, { status: 400 });\r\n    }\r\n\r\n    try {\r\n        const data = await fetchAmazonProduct(asin);\r\n\r\n        // Extract relevant info from PA-API response\r\n        const item = data.ItemsResult?.Items?.[0];\r\n\r\n        if (!item) {\r\n            return NextResponse.json({ error: 'Product not found' }, { status: 404 });\r\n        }\r\n\r\n        const price = item.Offers?.Listings?.[0]?.Price?.DisplayAmount || 'N/A';\r\n        const title = item.ItemInfo?.Title?.DisplayValue || '';\r\n        const isAvailable = !!item.Offers?.Listings?.[0]?.Price;\r\n        const liveLink = item.DetailPageURL || '';\r\n\r\n        return NextResponse.json({\r\n            asin,\r\n            price,\r\n            title,\r\n            isAvailable,\r\n            liveLink\r\n        });\r\n    } catch (error: any) {\r\n        console.error('API Route Error:', error);\r\n        return NextResponse.json({ error: error.message || 'Internal Server Error' }, { status: 500 });\r\n    }\r\n}\r\n"],"names":[],"mappings":";;;;AAAA;AACA;;;AAEO,eAAe,IAAI,OAAgB;IACtC,MAAM,EAAE,YAAY,EAAE,GAAG,IAAI,IAAI,QAAQ,GAAG;IAC5C,MAAM,OAAO,aAAa,GAAG,CAAC;IAE9B,IAAI,CAAC,MAAM;QACP,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,OAAO;QAAmB,GAAG;YAAE,QAAQ;QAAI;IAC1E;IAEA,IAAI;QACA,MAAM,OAAO,MAAM,IAAA,qJAAkB,EAAC;QAEtC,6CAA6C;QAC7C,MAAM,OAAO,KAAK,WAAW,EAAE,OAAO,CAAC,EAAE;QAEzC,IAAI,CAAC,MAAM;YACP,OAAO,gJAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAAoB,GAAG;gBAAE,QAAQ;YAAI;QAC3E;QAEA,MAAM,QAAQ,KAAK,MAAM,EAAE,UAAU,CAAC,EAAE,EAAE,OAAO,iBAAiB;QAClE,MAAM,QAAQ,KAAK,QAAQ,EAAE,OAAO,gBAAgB;QACpD,MAAM,cAAc,CAAC,CAAC,KAAK,MAAM,EAAE,UAAU,CAAC,EAAE,EAAE;QAClD,MAAM,WAAW,KAAK,aAAa,IAAI;QAEvC,OAAO,gJAAY,CAAC,IAAI,CAAC;YACrB;YACA;YACA;YACA;YACA;QACJ;IACJ,EAAE,OAAO,OAAY;QACjB,QAAQ,KAAK,CAAC,oBAAoB;QAClC,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,OAAO,MAAM,OAAO,IAAI;QAAwB,GAAG;YAAE,QAAQ;QAAI;IAChG;AACJ"}}]
}